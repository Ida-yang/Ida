<template>
    <!-- 登录页 -->
    <div>
        <el-row style="position:absolute;top:0;width:100%;height:8%;">
            <el-col  class="hidden-sm-and-down" 
                style=" margin-top:5px;margin-left:10%; display: inline-block;width:100%;">
                <div style="float:left;"><i><img src="../assets/image/logo.png" width="250px;"></i></div> 
                <div style="float:left;font-weight:bold;color:#1d1d1d;text-align:left;
                    font-size:22px;line-height:22px;margin:40px 0px 0px 20px;">
                    让工作变得越来越简单
                    <br/>
                    <span style="font-style:normal;font-weight:100;font-size:18px;">
                        To work is becoming more and more simple.
                    </span>
                </div> 
            </el-col>
            <el-col class="grid-content hidden-md-and-up" style="text-align:center;">
                <i><img src="../assets/image/logo.png" width="250px;"></i>
            </el-col>
            <!--屏幕小于sm则隐藏-->
            <!-- <el-col class="content-t hidden-sm-and-down" style="left: 1000px; margin-top: 30px">
                <div style="font-weight:bold;color:#1d1d1d;text-align:left;font-size:24px;line-height:30px;">
                    让工作变得越来越简单
                    <br/>
                    <span style="font-style:normal;font-weight:100;font-size:20px;">To work is becoming more and more simple.</span>
                </div> 
            </el-col> -->
        </el-row>
        <el-row style="width:100%;height:70%;position:absolute;top:10%;">
            <!--屏幕小于sm则隐藏-->
            <el-col :span="8" :offset="8" class="content-s hidden-sm-and-down systemTitle">
                <div style="color:#fff;text-align:left;font-size:48px;line-height:48px;">
                    纽恩泰QIS管理系统
                    <br/>
                    <span style="font-style:normal;font-weight:100;font-size:22px;line-height:22px;">
                        一个扎实、可靠、全面、可行的制造协同管理平台。
                    </span>
                </div>            
            </el-col>
            <!--屏幕小于sm则隐藏，此为大于sm的屏幕时显示的内容-->
            <el-col :span="8" :offset="8" class="grid-content content-r hidden-sm-and-down systemLogin">
                <div  style="color:#fff;font-size:30px;margin-top:5%;text-align:center">用户登录</div> 
                <div class="grid-content bg-purple-dark">
                    <el-form  :model="loginFrom" status-icon  :rules="rules"  ref="loginFrom" 
                    class="demo-ruleForm"
                    style="color:#fff" >
                        <i class="el-icon-new-zuzhiguanli selecticonSet"></i>
                        <el-form-item prop="orgId">
                            <el-select v-model="loginFrom.orgId" placeholder="请选择组织" style="position: relative;left:23px;display: inline-block;width:85%;margin-left:1%;">
                                    <el-option
                                    v-for="item in options"
                                    :key="item.id"
                                    :label="item.orgname"
                                    :value="item.orgname">
                                    </el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item prop="user">
                            <i class="el-icon-new-people_fill iconSet"></i>
                            <el-input type="text"
                                style="width:85%;margin-left:1%;" 
                                v-model="loginFrom.user"
                                auto-complete="off"
                                placeholder="请输入登录账号" 
                                >
                            </el-input>
                        </el-form-item>
                        <el-form-item  prop="password">
                            <i class="el-icon-new-lock_fill iconSet"></i>
                            <el-input type="password" 
                            v-model="loginFrom.password"
                            placeholder="请输入登录密码" 
                            @keyup.enter.native="submitForm('loginFrom')"
                            auto-complete="off" style="width:85% ;margin-left:1%;"></el-input>
                        </el-form-item>
                        <el-form-item style="width:80%;margin-left:7%">
                            <el-checkbox v-model="userNamechecked" style="color:#fff;float:left;" @change="rememberUserName">记住账号</el-checkbox>
                            <el-checkbox v-model="userPasschecked" style="color:#fff;float:right;" @change="rememberUserPass">记住密码</el-checkbox>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="submitForm('loginFrom')" style="width:85%;margin-left:7%;">登录</el-button>
                        </el-form-item>
                    </el-form>
                </div>
            </el-col>
            <!--屏幕大于md则隐藏，此为小于md的屏幕时显示的内容-->
            <el-col :span="8" :offset="8" class="grid-content content-r hidden-md-and-up systemLogin" style="left:50%;">
                <div  style="color:#fff;font-size:30px;margin-top:5%;text-align:center">纽恩泰QIS管理系统</div> 
                <div class="grid-content bg-purple-dark">
                    <el-form  :model="loginFrom" status-icon  :rules="rules"  ref="loginFrom" 
                    class="demo-ruleForm"
                    style="color:#fff" >
                        <el-form-item prop="orgId">
                            <el-select v-model="loginFrom.orgId" placeholder="请选择组织" style="width:85%;margin-left:7%;margin-top:5%;">
                                    <el-option
                                    v-for="item in options"
                                    :key="item.id"
                                    :label="item.orgname"
                                    :value="item.orgname">
                                    </el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item prop="user">
                            <el-input type="text"
                                style="width:85%;margin-left:7%;" 
                                v-model="loginFrom.user"
                                auto-complete="off"
                                placeholder="请输入登录账号" 
                                prefix-icon="el-icon-new-people_fill">
                            </el-input>
                        </el-form-item>
                        <el-form-item  prop="password">
                            <el-input type="password" 
                            v-model="loginFrom.password"
                            placeholder="请输入登录密码" 
                            prefix-icon="el-icon-new-lock_fill"
                            @keyup.enter.native="submitForm('loginFrom')"
                            auto-complete="off" style="width:85% ;margin-left:7%;"></el-input>
                        </el-form-item>
                        <el-form-item style="width:80%;margin-left:7%">
                            <el-checkbox v-model="userNamechecked" style="color:#fff;float:left;" @change="rememberUserName">记住账号</el-checkbox>
                            <el-checkbox v-model="userPasschecked" style="color:#fff;float:right;" @change="rememberUserPass">记住密码</el-checkbox>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="submitForm('loginFrom')" style="width:85%;margin-left:7%;">登录</el-button>
                        </el-form-item>
                    </el-form>
                </div>
            </el-col>
        </el-row>  
        <!--屏幕小于sm则隐藏，此为大于md的屏幕时显示的内容-->
        <el-row style="position: absolute;top: 85%; width:100%;height:15%;" class="hidden-sm-and-down">
            <el-col :span="8" :offset="8" class="content-b" style="width:420px;font-size:12px;">
                Copyright © 2018 广州佳帆计算机有限公司.  
                <br>
                联系电话：020-8985 9531 
                <br>
                地址：广州市天河区车陂路启明大街93号安定楼308-310室
            </el-col>
            <el-col :span="8" :offset="8" class="content-b" style="left:50%;top:5%;">
                <div style="position:absolute;top:0;">
                    <i><img src="../assets/image/subscriptionnumber.jpg" height="85px"></i>
                    <br>
                    <span style="font-size:12px;line-height:14px;position:absolute;top:88px;">佳帆微信公众号</span>
                </div>
            </el-col>
        </el-row>
        <!--屏幕大于md则隐藏，此为小于md的屏幕时显示的内容-->
        <el-row style="position: absolute;top: 85%; width:100%;height:15%;" class="hidden-md-and-up">
            <el-col :span="8" :offset="8" class="content-b" style="left:26%;top:50%;">
                <div style="padding:5px;">
                    <i><img src="../assets/image/subscriptionnumber.jpg" width="85px"></i>
                    <br>
                    <span style="font-size:14px;line-height:14px;position:absolute;top:88px;left:-0.5%;">佳帆微信公众号</span>
                </div>
            </el-col>
        </el-row>
    </div>  
</template>

<script>
import store from '../store/store'
import '../assets/iconfont/iconfont.css'
import axios from 'axios'
import 'element-ui/lib/theme-chalk/display.css'
import $ from 'jquery'

export default { 
    name: 'login',
    computed: {
        options(){
            return store.state.organizationList;
        }
    },
    store,
    data () {
    return {
        loginFrom:{
            orgId:'',
            user:'',
            password:''
        },
        selectList:null,
        userNamechecked:false,
        userPasschecked:false,
        value: '',
        rules: {
            orgId: [
                { required: true, message: '请选择组织', trigger: 'change' }
            ],
            user: [
                { required: true, message: '请输入用户名', trigger: 'blur' },
            ],
            password: [
                { required: true, message: '请输入密码', trigger: 'blur' },
            ],
        }
    }
    },
    beforeCreate(){
        let _this = this;
            axios({
                    method: 'post',
                    url: _this.$store.state.defaultHttp+_this.$store.state.orgURL+'selectByCriteria',
                }).then(function(res){
                    _this.loginFrom.orgId = localStorage.getItem("orgname")
                    _this.$store.state.organizationList = res.data.result.records;
                    _this.$store.state.organizationListnumber = res.data.result.totalRecords;
                }).catch(function(err){
                // console.log(err)
                })
                
    },

    beforeMount(){
        
        this.loginFrom.user=localStorage.getItem("userName");
        this.loginFrom.password=localStorage.getItem("userPass");
        
        if(localStorage.getItem("userNameChecked"))
            this.userNamechecked=true;
        if(localStorage.getItem("userPasschecked"))
            this.userPasschecked=true;
    },
    mounted() {
        var backgroundImage = $("body").css("background-image");
        $("body").css("background-image", "none");
        $("body").css("background", "#fff");
        $("body").css("opacity", "0");
        // setTimeout(function(){
            $("body").animate({opacity: "1"}, 300, "linear",function(){
                $("body").css("background", "");
                $("body").css("background-image", backgroundImage);
                $(".systemTitle").show(500);
                $(".systemLogin").show(500);
            });
        // },100);
    },
    methods: {
        rememberUserName (){
            if(this.userNamechecked){
                this.userNamechecked = true;
            }else{
                this.userNamechecked = false;
                this.userPasschecked = false;
            }
        },
        rememberUserPass (){
            if(this.userPasschecked){
                this.userNamechecked = true;
                this.userPasschecked = true;
            }else{
                this.userPasschecked = false;
            }
        },
        submitForm(from) {
            let neworgId=null;
            for(var i=0;i<this.$store.state.organizationList.length;i++){
                if(this.loginFrom.orgId == this.$store.state.organizationList[i].orgname){
                    neworgId=this.$store.state.organizationList[i].id
                     
                }
            }
            localStorage.setItem('orgname',this.loginFrom.orgId);
            let logInfo = {};
                logInfo.orgId = neworgId;
                logInfo.user = this.loginFrom.user;
                logInfo.account = this.loginFrom.user;
                logInfo.password = this.loginFrom.password;
            let SaveSelection={};
                SaveSelection.userNamechecked = (this.userNamechecked).toString();
                SaveSelection.userPasschecked = (this.userPasschecked).toString();
            let data=[logInfo,SaveSelection,this];
            if(!logInfo.orgId) {
                this.$message({
                    message: "组织不能为空",
                    type: 'error'
                });
                return;
            }
            if(!logInfo.account) {
                this.$message({
                    message: "账号不能为空",
                    type: 'error'
                });
                return;
            }
            if(!logInfo.password) {
                this.$message({
                    message: "密码不能为空",
                    type: 'error'
                });
                return;
            }
            this.$store.dispatch('loginForm',data);
            }
    }
}
</script>

<style>
    body{
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        min-height: 600px;
        background-image: url(../assets/image/loginbg.jpg);
        background-repeat: no-repeat;
        background-size: 100% 68%;
        background-position:center; 
    }
    .systemTitle {
        display: none;
    }
    .systemLogin {
        display: none;
    }

   /* .loginBox{
       width: 80%;
       text-align: center;
   } */
   .selecticonSet{
        position: relative;
        font-size: 19px;
        left: 2px;
        bottom: -30px;
        z-index: 999;
        color: #bfcbd9;
   }
   .iconSet{
        position: relative;
        font-size: 19px;
        left: 2px;
        bottom: -3px;
        z-index: 999;
        color: #bfcbd9;

    }
   .content-t{
       margin: auto;
       position: absolute;
       top:70%;
       transform: translate(-50%,-50%);
       color: #1d1d1d;
   }
   .content-b{
       line-height: 30px;
       position: absolute;
       top:50%;
       transform: translate(-50%,-50%);
       color: #1d1d1d;
   }
   .content-s {
        width: 45%;
        color: #fff;
        margin: auto;
        padding: 0;
        position: absolute;
        left: 32%;
        top: 50%;
        -webkit-transform: translate(-50%,-50%);
        transform: translate(-50%,-50%);
    }
   .content-l{
       width: 45%;
       color: #fff;
       margin: auto;
       padding: 0;
       position: absolute;
       left: 32%;
       top: 0%;
       transform: translate(-50%,-50%);
   }
   .content-r{
       width: 360px;
       background-color: rgba(255, 255, 255, 0.1);
       border-radius: 50px;
       margin: auto;
       padding: 15px 10px;
       position: absolute;
       left: 75%;
       top: 58%;
       transform: translate(-50%,-50%);
   }
    .el-form-item__error{
        left: 20% !important;
    }
</style>
