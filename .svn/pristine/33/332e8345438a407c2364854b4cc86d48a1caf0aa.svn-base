import Vue from 'vue'
import Router from 'vue-router'
import store from './../store/store'
Vue.use(Router)


if (sessionStorage.getItem('token')) {
  store.commit('set_token', localStorage.getItem('token'))
  }
  

const router =new Router({
  
  mode: "history",/**** 生产开发模式，需要部署时要删除（注释），再进行打包 ****/
  
  routes: [
    {
      path:'/index',
      name:'index',
      component:resolve => require(['../components/index/index.vue'], resolve),
      meta: { title: '首页' ,requireAuth:true},
      children:[
        {
          path: '/',
          component: resolve => require(['../components/index/page/welcome.vue'], resolve),
          meta: { title: '欢迎页面' }
        },
        {
          path: '/welcome',
          component: resolve => require(['../components/index/page/welcome.vue'], resolve),
          meta: { title: '欢迎页面' }
        },
        {
            path: '/OrganizationAndManagement',
            component: resolve => require(['../components/index/page/Organization/OrganizationAndManagement.vue'], resolve),
            meta: { title: '组织管理'}
        },
        {
          path: '/OutboundOrder',
          component: resolve => require(['../components/index/page/storageManagement/OutboundOrder.vue'], resolve),
          meta: { title: '出库单'}
        },
        {
          path: '/ProductioWorkOrder',
          component: resolve => require(['../components/index/page/storageManagement/ProductioWorkOrder.vue'], resolve),
          meta: { title: '生产工单' }
        },
        {
          path: '/UserManagement',
          component: resolve => require(['../components/index/page/SystemSettings/UserManagement.vue'], resolve),
          meta: { title: '角色权限管理'}
        },
        {
          path: '/UserData',
          component: resolve => require(['../components/index/page/SystemSettings/UserData.vue'], resolve),
          meta: { title: '用户资料' }
        },
        {
          path: '/WarehouseData',
          component: resolve => require(['../components/index/page/BasicData/WarehouseData.vue'], resolve),
          meta: { title: '仓库资料'}
        },
        {
          path: '/StoragePosition',
          component: resolve => require(['../components/index/page/BasicData/StoragePosition.vue'], resolve),
          meta: { title: '筐位资料'}
        },
        {
          path: '/CustomerData',
          component: resolve => require(['../components/index/page/BasicData/CustomerData.vue'], resolve),
          meta: { title: '客户资料'}
        },
        {
          path: '/SupplierData',
          component: resolve => require(['../components/index/page/BasicData/SupplierData.vue'], resolve),
          meta: { title: '供应商资料'}
        },
        {
          path: '/MaterielData',
          component: resolve => require(['../components/index/page/BasicData/MaterielData.vue'], resolve),
          meta: { title: '物料资料'}
        },
        {
          path: '/BadCause',
          component: resolve => require(['../components/index/page/BasicData/BadCause.vue'], resolve),
          meta: { title: '不良原因'}
        },
        {
          path: '/ProductionLine',
          component: resolve => require(['../components/index/page/BasicData/ProductionLine.vue'], resolve),
          meta: { title: '产线资料'}
        },
        {
          path: '/ProductionProcess',
          component: resolve => require(['../components/index/page/TechnologyRoute/ProductionProcess.vue'], resolve),
          meta: { title: '生产工序'}
        },
        {
          path: '/TechnologicalProcess',
          component: resolve => require(['../components/index/page/TechnologyRoute/TechnologicalProcess.vue'], resolve),
          meta: { title: '工艺流程'}
        },
        {
          path: '/OrderDetails',
          component: resolve => require(['../components/index/page/storageManagement/OrderDetails.vue'], resolve),
          meta: { title: '出库单详情'}
        },
        {
          path: '/PrintSerialNumber',
          component: resolve => require(['../components/index/page/storageManagement/PrintSerialNumber.vue'], resolve),
          meta: { title: '打印产品序列号条码'}
        }
      ]
    },
        {
            path: '*',
            redirect: '/index'
        },
        {
            path: '/login',
            component: resolve => require(['../components/Login.vue'], resolve)
        }
  ]
})

router.beforeEach((to, from, next) => {
  if (to.matched.some(r => r.meta.requireAuth)) {
    if (sessionStorage.getItem('token')) {
      next();
    }else {
      next({
        path: '/login',
        query: {redirect: to.fullPath}
      })
    }
  }else {
    next();
  }
})
export default  router
