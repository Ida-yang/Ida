import Vue from 'vue'
import Router from 'vue-router'
import store from './../store/store'
Vue.use(Router)


if (sessionStorage.getItem('token')) {
  store.commit('set_token', localStorage.getItem('token'))
  }
  

const router =new Router({
  
  mode: "history",
  routes: [
    {
      path:'/index',
      name:'index',
      component:resolve => require(['../components/index/index.vue'], resolve),
      meta: { title: '首页' ,requireAuth:true},
      children:[
        {
          path: '/',
          component: resolve => require(['../components/index/page/welcome.vue'], resolve),
          meta: { title: '欢迎页面' }
        },
        {
          path: '/welcome',
          component: resolve => require(['../components/index/page/welcome.vue'], resolve),
          meta: { title: '欢迎页面' }
        },
        {
            path: '/OrganizationAndManagement',
            component: resolve => require(['../components/index/page/Organization/OrganizationAndManagement.vue'], resolve),
            meta: { title: '组织管理'}
        },
        {
          path: '/OutboundOrder',
          component: resolve => require(['../components/index/page/storageManagement/OutboundOrder.vue'], resolve),
          meta: { title: '出库单'}
        },
        {
          path: '/ProductioWorkOrder',
          component: resolve => require(['../components/index/page/storageManagement/ProductioWorkOrder.vue'], resolve),
          meta: { title: '生产工单' }
        },
        {
          path: '/UserManagement',
          component: resolve => require(['../components/index/page/SystemSettings/UserManagement.vue'], resolve),
          meta: { title: '角色权限管理'}
        },
        {
          path: '/userData',
          component: resolve => require(['../components/index/page/SystemSettings/userData.vue'], resolve),
          meta: { title: '用户资料' }
        },
        {
          path: '/WarehouseData',
          component: resolve => require(['../components/index/page/BasicData/WarehouseData.vue'], resolve),
          meta: { title: '仓库资料'}
        },
        {
          path: '/OrderDetails',
          component: resolve => require(['../components/index/page/storageManagement/OrderDetails.vue'], resolve),
          meta: { title: '出库单详情'}
        },
        {
          path: '/PrintSerialNumber',
          component: resolve => require(['../components/index/page/storageManagement/PrintSerialNumber.vue'], resolve),
          meta: { title: '打印产品序列号条码',keepAlive: false}
        }
      ]
    },
        {
            path: '*',
            redirect: '/login'
        },
        {
            path: '/login',
            component: resolve => require(['../components/Login.vue'], resolve)
        },
        {
            path: '/404',
            component: resolve => require(['../components/index/page/404.vue'], resolve)
        },
        {
            path: '/403',
            component: resolve => require(['../components/index/page/403.vue'], resolve)
        },
  ]
})

router.beforeEach((to, from, next) => {
  if (to.matched.some(r => r.meta.requireAuth)) {
    if (store.state.token) {
      next();
    }else {
      next({
        path: '/login',
        query: {redirect: to.fullPath}
      })
    }
  }else {
    next();
  }
})
export default  router
